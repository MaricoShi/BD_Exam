(function(e,t,o,s){"use strict";var i="treeview";var n={};n.settings={injectStyle:true,levels:2,expandIcon:"glyphicon glyphicon-plus",collapseIcon:"glyphicon glyphicon-minus",emptyIcon:"glyphicon",nodeIcon:"",selectedIcon:"",checkedIcon:"glyphicon glyphicon-check",uncheckedIcon:"glyphicon glyphicon-unchecked",color:s,backColor:s,borderColor:s,onhoverColor:"#F5F5F5",selectedColor:"#FFFFFF",selectedBackColor:"#428bca",searchResultColor:"#D9534F",searchResultBackColor:s,enableLinks:false,highlightSelected:true,highlightSearchResults:true,showBorder:true,showIcon:true,showCheckbox:false,showTags:false,multiSelect:false,onNodeChecked:s,onNodeCollapsed:s,onNodeDisabled:s,onNodeEnabled:s,onNodeExpanded:s,onNodeSelected:s,onNodeUnchecked:s,onNodeUnselected:s,onSearchComplete:s,onSearchCleared:s};n.options={silent:false,ignoreChildren:false};n.searchOptions={ignoreCase:true,exactMatch:false,revealResults:true};var d=function(t,o){this.$element=e(t);this.elementId=t.id;this.styleId=this.elementId+"-style";this.init(o);return{options:this.options,init:e.proxy(this.init,this),remove:e.proxy(this.remove,this),exchangeNode:e.proxy(this.exchangeNode,this),addNode:e.proxy(this.addNode,this),editNode:e.proxy(this.editNode,this),deleteNode:e.proxy(this.deleteNode,this),getNode:e.proxy(this.getNode,this),getParent:e.proxy(this.getParent,this),getSiblings:e.proxy(this.getSiblings,this),getSelected:e.proxy(this.getSelected,this),getUnselected:e.proxy(this.getUnselected,this),getExpanded:e.proxy(this.getExpanded,this),getCollapsed:e.proxy(this.getCollapsed,this),getChecked:e.proxy(this.getChecked,this),getUnchecked:e.proxy(this.getUnchecked,this),getDisabled:e.proxy(this.getDisabled,this),getEnabled:e.proxy(this.getEnabled,this),selectNode:e.proxy(this.selectNode,this),unselectNode:e.proxy(this.unselectNode,this),toggleNodeSelected:e.proxy(this.toggleNodeSelected,this),collapseAll:e.proxy(this.collapseAll,this),collapseNode:e.proxy(this.collapseNode,this),expandAll:e.proxy(this.expandAll,this),expandNode:e.proxy(this.expandNode,this),toggleNodeExpanded:e.proxy(this.toggleNodeExpanded,this),revealNode:e.proxy(this.revealNode,this),checkAll:e.proxy(this.checkAll,this),checkNode:e.proxy(this.checkNode,this),uncheckAll:e.proxy(this.uncheckAll,this),uncheckNode:e.proxy(this.uncheckNode,this),toggleNodeChecked:e.proxy(this.toggleNodeChecked,this),disableAll:e.proxy(this.disableAll,this),disableNode:e.proxy(this.disableNode,this),enableAll:e.proxy(this.enableAll,this),enableNode:e.proxy(this.enableNode,this),toggleNodeDisabled:e.proxy(this.toggleNodeDisabled,this),search:e.proxy(this.search,this),clearSearch:e.proxy(this.clearSearch,this)}};d.prototype.init=function(t){this.tree=[];this.nodes=[];if(t.data){if(typeof t.data==="string"){t.data=e.parseJSON(t.data)}this.tree=e.extend(true,[],t.data);delete t.data}this.options=e.extend({},n.settings,t);this.destroy();this.subscribeEvents();this.setInitialStates({nodes:this.tree},0);this.render()};d.prototype.remove=function(){this.destroy();e.removeData(this,i);e("#"+this.styleId).remove()};d.prototype.exchangeNode=function(t,o,s,i){debugger;this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setExchangeNode(e,s,i)},this));this.setInitialStates({nodes:this.tree},0);this.render()};d.prototype.setExchangeNode=function(e,t,o){var s,i,n,d;if(t>o){t^=o;o^=t;t^=o}for(var r=0,a=e.nodes.length;r<a;r++){if(e.nodes[r].nodeId==t){s=r;n=e.nodes[r]}else if(e.nodes[r].nodeId==o){i=r;d=e.nodes[r]}if(n&&d){break}}e.nodes.splice(s,1,d);e.nodes.splice(i,1,n)};d.prototype.addNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setOperateNode(e,t,"add")},this));this.setInitialStates({nodes:this.tree},0);this.render()};d.prototype.editNode=function(t,o){debugger;this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setOperateNode(e,t,"modify")},this));this.setInitialStates({nodes:this.tree},0);this.render()};d.prototype.deleteNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setOperateNode(e,t,"delete")},this));this.setInitialStates({nodes:this.tree},0);this.render()};d.prototype.setOperateNode=function(t,o,s){if(!s)return;switch(s){case"add":if(t.nodes==null)t.nodes=[];if(o.node){t.nodes.push(o.node)};break;case"modify":e.extend(t,o.node||{});break;case"delete":var i=this.getNode(t.parentId);if(i.nodes){for(var n=0,d=i.nodes.length;n<d;n++){if(i.nodes[n].nodeId==t.nodeId){i.nodes.splice(n,1);break}}};break}};d.prototype.destroy=function(){if(!this.initialized)return;this.$wrapper.remove();this.$wrapper=null;this.unsubscribeEvents();this.initialized=false};d.prototype.unsubscribeEvents=function(){this.$element.off("click");this.$element.off("nodeChecked");this.$element.off("nodeCollapsed");this.$element.off("nodeDisabled");this.$element.off("nodeEnabled");this.$element.off("nodeExpanded");this.$element.off("nodeSelected");this.$element.off("nodeUnchecked");this.$element.off("nodeUnselected");this.$element.off("searchComplete");this.$element.off("searchCleared")};d.prototype.subscribeEvents=function(){this.unsubscribeEvents();this.$element.on("click",e.proxy(this.clickHandler,this));if(typeof this.options.onNodeChecked==="function"){this.$element.on("nodeChecked",this.options.onNodeChecked)}if(typeof this.options.onNodeCollapsed==="function"){this.$element.on("nodeCollapsed",this.options.onNodeCollapsed)}if(typeof this.options.onNodeDisabled==="function"){this.$element.on("nodeDisabled",this.options.onNodeDisabled)}if(typeof this.options.onNodeEnabled==="function"){this.$element.on("nodeEnabled",this.options.onNodeEnabled)}if(typeof this.options.onNodeExpanded==="function"){this.$element.on("nodeExpanded",this.options.onNodeExpanded)}if(typeof this.options.onNodeSelected==="function"){this.$element.on("nodeSelected",this.options.onNodeSelected)}if(typeof this.options.onNodeUnchecked==="function"){this.$element.on("nodeUnchecked",this.options.onNodeUnchecked)}if(typeof this.options.onNodeUnselected==="function"){this.$element.on("nodeUnselected",this.options.onNodeUnselected)}if(typeof this.options.onSearchComplete==="function"){this.$element.on("searchComplete",this.options.onSearchComplete)}if(typeof this.options.onSearchCleared==="function"){this.$element.on("searchCleared",this.options.onSearchCleared)}};d.prototype.setInitialStates=function(t,o){if(!t.nodes)return;o+=1;var s=t;var i=this;e.each(t.nodes,function e(t,n){n.nodeId=i.nodes.length;n.parentId=s.nodeId;if(!n.hasOwnProperty("selectable")){n.selectable=true}n.state=n.state||{};if(!n.state.hasOwnProperty("checked")){n.state.checked=false}if(!n.state.hasOwnProperty("disabled")){n.state.disabled=false}if(!n.state.hasOwnProperty("expanded")){if(!n.state.disabled&&o<i.options.levels&&(n.nodes&&n.nodes.length>0)){n.state.expanded=true}else{n.state.expanded=false}}if(!n.state.hasOwnProperty("selected")){n.state.selected=false}i.nodes.push(n);if(n.nodes){i.setInitialStates(n,o)}})};d.prototype.clickHandler=function(t){if(!this.options.enableLinks)t.preventDefault();var o=e(t.target);var s=this.findNode(o);if(!s||s.state.disabled)return;var i=o.attr("class")?o.attr("class").split(" "):[];if(i.indexOf("expand-icon")!==-1){this.toggleExpandedState(s,n.options);this.render()}else if(i.indexOf("check-icon")!==-1){this.toggleCheckedState(s,n.options);this.render()}else{if(s.selectable){this.toggleSelectedState(s,n.options)}else{this.toggleExpandedState(s,n.options)}this.render()}};d.prototype.findNode=function(e){var t=e.closest("li.list-group-item").attr("data-nodeid");var o=this.nodes[t];if(!o){console.log("Error: node does not exist")}return o};d.prototype.toggleExpandedState=function(e,t){if(!e)return;this.setExpandedState(e,!e.state.expanded,t)};d.prototype.setExpandedState=function(t,o,s){if(o===t.state.expanded)return;if(o&&t.nodes){t.state.expanded=true;if(!s.silent){this.$element.trigger("nodeExpanded",e.extend(true,{},t))}}else if(!o){t.state.expanded=false;if(!s.silent){this.$element.trigger("nodeCollapsed",e.extend(true,{},t))}if(t.nodes&&!s.ignoreChildren){e.each(t.nodes,e.proxy(function(e,t){this.setExpandedState(t,false,s)},this))}}};d.prototype.toggleSelectedState=function(e,t){if(!e)return;this.setSelectedState(e,!e.state.selected,t)};d.prototype.setSelectedState=function(t,o,s){if(o===t.state.selected)return;if(o){if(!this.options.multiSelect){e.each(this.findNodes("true","g","state.selected"),e.proxy(function(e,t){this.setSelectedState(t,false,s)},this))}t.state.selected=true;if(!s.silent){this.$element.trigger("nodeSelected",e.extend(true,{},t))}}else{t.state.selected=false;if(!s.silent){this.$element.trigger("nodeUnselected",e.extend(true,{},t))}}};d.prototype.toggleCheckedState=function(e,t){if(!e)return;this.setCheckedState(e,!e.state.checked,t)};d.prototype.setCheckedState=function(t,o,s){if(o===t.state.checked)return;if(o){t.state.checked=true;if(!s.silent){this.$element.trigger("nodeChecked",e.extend(true,{},t))}}else{t.state.checked=false;if(!s.silent){this.$element.trigger("nodeUnchecked",e.extend(true,{},t))}}};d.prototype.setDisabledState=function(t,o,s){if(o===t.state.disabled)return;if(o){t.state.disabled=true;this.setExpandedState(t,false,s);this.setSelectedState(t,false,s);this.setCheckedState(t,false,s);if(!s.silent){this.$element.trigger("nodeDisabled",e.extend(true,{},t))}}else{t.state.disabled=false;if(!s.silent){this.$element.trigger("nodeEnabled",e.extend(true,{},t))}}};d.prototype.render=function(){if(!this.initialized){this.$element.addClass(i);this.$wrapper=e(this.template.list);this.injectStyle();this.initialized=true}this.$element.empty().append(this.$wrapper.empty());this.buildTree(this.tree,0)};d.prototype.buildTree=function(t,o){if(!t)return;o+=1;var s=this;e.each(t,function t(i,n){var d=e(s.template.item).addClass("node-"+s.elementId).addClass(n.state.checked?"node-checked":"").addClass(n.state.disabled?"node-disabled":"").addClass(n.state.selected?"node-selected":"").addClass(n.searchResult?"search-result":"").attr("data-nodeid",n.nodeId).attr("style",s.buildStyleOverride(n));for(var r=0;r<o-1;r++){d.append(s.template.indent)}var a=[];if(n.nodes){a.push("expand-icon");if(n.state.expanded){a.push(s.options.collapseIcon)}else{a.push(s.options.expandIcon)}}else{a.push(s.options.emptyIcon)}d.append(e(s.template.icon).addClass(a.join(" ")));if(s.options.showIcon){var a=["node-icon"];a.push(n.icon||s.options.nodeIcon);if(n.state.selected){a.pop();a.push(n.selectedIcon||s.options.selectedIcon||n.icon||s.options.nodeIcon)}d.append(e(s.template.icon).addClass(a.join(" ")))}if(s.options.showCheckbox){var a=["check-icon"];if(n.state.checked){a.push(s.options.checkedIcon)}else{a.push(s.options.uncheckedIcon)}d.append(e(s.template.icon).addClass(a.join(" ")))}if(s.options.enableLinks){d.append(e(s.template.link).attr("href",n.href).append(n.text))}else{d.append(n.text)}if(s.options.showTags&&n.tags){e.each(n.tags,function t(o,i){d.append(e(s.template.badge).append(i))})}s.$wrapper.append(d);if(n.nodes&&n.state.expanded&&!n.state.disabled){return s.buildTree(n.nodes,o)}})};d.prototype.buildStyleOverride=function(e){if(e.state.disabled)return"";var t=e.color;var o=e.backColor;if(this.options.highlightSelected&&e.state.selected){if(this.options.selectedColor){t=this.options.selectedColor}if(this.options.selectedBackColor){o=this.options.selectedBackColor}}if(this.options.highlightSearchResults&&e.searchResult&&!e.state.disabled){if(this.options.searchResultColor){t=this.options.searchResultColor}if(this.options.searchResultBackColor){o=this.options.searchResultBackColor}}return"color:"+t+";background-color:"+o+";"};d.prototype.injectStyle=function(){if(this.options.injectStyle&&!o.getElementById(this.styleId)){e('<style type="text/css" id="'+this.styleId+'"> '+this.buildStyle()+" </style>").appendTo("head")}};d.prototype.buildStyle=function(){var e=".node-"+this.elementId+"{";if(this.options.color){e+="color:"+this.options.color+";"}if(this.options.backColor){e+="background-color:"+this.options.backColor+";"}if(!this.options.showBorder){e+="border:none;"}else if(this.options.borderColor){e+="border:1px solid "+this.options.borderColor+";"}e+="}";if(this.options.onhoverColor){e+=".node-"+this.elementId+":not(.node-disabled):hover{"+"background-color:"+this.options.onhoverColor+";"+"}"}return this.css+e};d.prototype.template={list:'<ul class="list-group"></ul>',item:'<li class="list-group-item"></li>',indent:'<span class="indent"></span>',icon:'<span class="icon"></span>',link:'<a href="#" style="color:inherit;"></a>',badge:'<span class="badge"></span>'};d.prototype.css=".treeview .list-group-item{cursor:pointer}.treeview span.indent{margin-left:10px;margin-right:10px}.treeview span.icon{width:12px;margin-right:5px}.treeview .node-disabled{color:silver;cursor:not-allowed}";d.prototype.getNode=function(e){return this.nodes[e]};d.prototype.getParent=function(e){var t=this.identifyNode(e);return this.nodes[t.parentId]};d.prototype.getSiblings=function(e){var t=this.identifyNode(e);var o=this.getParent(t);var s=o?o.nodes:this.tree;return s.filter(function(e){return e.nodeId!==t.nodeId})};d.prototype.getSelected=function(){return this.findNodes("true","g","state.selected")};d.prototype.getUnselected=function(){return this.findNodes("false","g","state.selected")};d.prototype.getExpanded=function(){return this.findNodes("true","g","state.expanded")};d.prototype.getCollapsed=function(){return this.findNodes("false","g","state.expanded")};d.prototype.getChecked=function(){return this.findNodes("true","g","state.checked")};d.prototype.getUnchecked=function(){return this.findNodes("false","g","state.checked")};d.prototype.getDisabled=function(){return this.findNodes("true","g","state.disabled")};d.prototype.getEnabled=function(){return this.findNodes("false","g","state.disabled")};d.prototype.selectNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setSelectedState(e,true,t)},this));this.render()};d.prototype.unselectNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setSelectedState(e,false,t)},this));this.render()};d.prototype.toggleNodeSelected=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.toggleSelectedState(e,t)},this));this.render()};d.prototype.collapseAll=function(t){var o=this.findNodes("true","g","state.expanded");this.forEachIdentifier(o,t,e.proxy(function(e,t){this.setExpandedState(e,false,t)},this));this.render()};d.prototype.collapseNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setExpandedState(e,false,t)},this));this.render()};d.prototype.expandAll=function(t){t=e.extend({},n.options,t);if(t&&t.levels){this.expandLevels(this.tree,t.levels,t)}else{var o=this.findNodes("false","g","state.expanded");this.forEachIdentifier(o,t,e.proxy(function(e,t){this.setExpandedState(e,true,t)},this))}this.render()};d.prototype.expandNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setExpandedState(e,true,t);if(e.nodes&&(t&&t.levels)){this.expandLevels(e.nodes,t.levels-1,t)}},this));this.render()};d.prototype.expandLevels=function(t,o,s){s=e.extend({},n.options,s);e.each(t,e.proxy(function(e,t){this.setExpandedState(t,o>0?true:false,s);if(t.nodes){this.expandLevels(t.nodes,o-1,s)}},this))};d.prototype.revealNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){var o=this.getParent(e);while(o){this.setExpandedState(o,true,t);o=this.getParent(o)}},this));this.render()};d.prototype.toggleNodeExpanded=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.toggleExpandedState(e,t)},this));this.render()};d.prototype.checkAll=function(t){var o=this.findNodes("false","g","state.checked");this.forEachIdentifier(o,t,e.proxy(function(e,t){this.setCheckedState(e,true,t)},this));this.render()};d.prototype.checkNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setCheckedState(e,true,t)},this));this.render()};d.prototype.uncheckAll=function(t){var o=this.findNodes("true","g","state.checked");this.forEachIdentifier(o,t,e.proxy(function(e,t){this.setCheckedState(e,false,t)},this));this.render()};d.prototype.uncheckNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setCheckedState(e,false,t)},this));this.render()};d.prototype.toggleNodeChecked=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.toggleCheckedState(e,t)},this));this.render()};d.prototype.disableAll=function(t){var o=this.findNodes("false","g","state.disabled");this.forEachIdentifier(o,t,e.proxy(function(e,t){this.setDisabledState(e,true,t)},this));this.render()};d.prototype.disableNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setDisabledState(e,true,t)},this));this.render()};d.prototype.enableAll=function(t){var o=this.findNodes("true","g","state.disabled");this.forEachIdentifier(o,t,e.proxy(function(e,t){this.setDisabledState(e,false,t)},this));this.render()};d.prototype.enableNode=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setDisabledState(e,false,t)},this));this.render()};d.prototype.toggleNodeDisabled=function(t,o){this.forEachIdentifier(t,o,e.proxy(function(e,t){this.setDisabledState(e,!e.state.disabled,t)},this));this.render()};d.prototype.forEachIdentifier=function(t,o,s){o=e.extend({},n.options,o);if(!(t instanceof Array)){t=[t]}e.each(t,e.proxy(function(e,t){s(this.identifyNode(t),o)},this))};d.prototype.identifyNode=function(e){return typeof e==="number"?this.nodes[e]:e};d.prototype.search=function(t,o){o=e.extend({},n.searchOptions,o);this.clearSearch({render:false});var s=[];if(t&&t.length>0){if(o.exactMatch){t="^"+t+"$"}var i="g";if(o.ignoreCase){i+="i"}s=this.findNodes(t,i);e.each(s,function(e,t){t.searchResult=true})}if(o.revealResults){this.revealNode(s)}else{this.render()}this.$element.trigger("searchComplete",e.extend(true,{},s));return s};d.prototype.clearSearch=function(t){t=e.extend({},{render:true},t);var o=e.each(this.findNodes("true","g","searchResult"),function(e,t){t.searchResult=false});if(t.render){this.render()}this.$element.trigger("searchCleared",e.extend(true,{},o))};d.prototype.findNodes=function(t,o,s){o=o||"g";s=s||"text";var i=this;return e.grep(this.nodes,function(e){var n=i.getNodeValue(e,s);if(typeof n==="string"){return n.match(new RegExp(t,o))}})};d.prototype.getNodeValue=function(e,t){var o=t.indexOf(".");if(o>0){var i=e[t.substring(0,o)];var n=t.substring(o+1,t.length);return this.getNodeValue(i,n)}else{if(e.hasOwnProperty(t)){return e[t].toString()}else{return s}}};var r=function(e){if(t.console){t.console.error(e)}};e.fn[i]=function(t,o){var s;this.each(function(){var n=e.data(this,i);if(typeof t==="string"){if(!n){r("Not initialized, can not call method : "+t)}else if(!e.isFunction(n[t])||t.charAt(0)==="_"){r("No such method : "+t)}else{if(!(o instanceof Array)){o=[o]}s=n[t].apply(n,o)}}else if(typeof t==="boolean"){s=n}else{e.data(this,i,new d(this,e.extend(true,{},t)))}});return s||this}})(jQuery,window,document);